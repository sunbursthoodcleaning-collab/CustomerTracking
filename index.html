<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUNBURST Hood Cleaning - Customer Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-orange: #FF6B35;
            --secondary-orange: #F7931E;
            --dark-blue: #2c3e50;
            --light-gray: #f8f9fa;
            --border-gray: #e1e8ed;
            --text-gray: #666;
            --success-green: #28a745;
            --warning-yellow: #ffc107;
            --danger-red: #dc3545;
            --shadow-light: 0 5px 15px rgba(0,0,0,0.1);
            --shadow-medium: 0 10px 25px rgba(0,0,0,0.1);
            --shadow-heavy: 0 20px 40px rgba(0,0,0,0.1);
            --border-radius: 10px;
            --border-radius-large: 20px;
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--secondary-orange) 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark-blue);
        }

        /* Login Screen Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-card {
            background: white;
            border-radius: var(--border-radius-large);
            box-shadow: var(--shadow-heavy);
            padding: 50px;
            width: 100%;
            max-width: 450px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .login-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 107, 53, 0.05) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
            50% { transform: translate(-50%, -50%) rotate(180deg); }
        }

        .login-header {
            position: relative;
            z-index: 2;
            margin-bottom: 40px;
        }

        .login-header h1 {
            font-size: 2.2em;
            color: var(--primary-orange);
            margin-bottom: 10px;
            font-weight: 700;
        }

        .login-header p {
            color: var(--text-gray);
            font-size: 1.1em;
        }

        .login-form {
            position: relative;
            z-index: 2;
        }

        .form-group {
            margin-bottom: 25px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-blue);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group input {
            width: 100%;
            padding: 15px 18px;
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
            background: white;
            font-family: inherit;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary-orange);
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
            transform: translateY(-2px);
        }

        .login-btn {
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--secondary-orange) 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-light);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            width: 100%;
        }

        .login-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: var(--transition);
        }

        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 107, 53, 0.4);
        }

        .login-btn:hover::before {
            left: 100%;
        }

        .login-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px 18px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            border-left: 4px solid var(--danger-red);
            font-weight: 500;
        }

        /* Main App Styles (same as before) */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: var(--border-radius-large);
            box-shadow: var(--shadow-heavy);
            overflow: hidden;
            position: relative;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border-gray);
            border-top: 4px solid var(--primary-orange);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .header {
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--secondary-orange) 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
            position: relative;
            z-index: 2;
        }

        .header p {
            opacity: 0.95;
            font-size: 1.2em;
            position: relative;
            z-index: 2;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            z-index: 3;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            color: white;
            font-weight: 600;
            z-index: 10000;
            transform: translateX(400px);
            transition: var(--transition);
            box-shadow: var(--shadow-medium);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { background: var(--success-green); }
        .notification.error { background: var(--danger-red); }
        .notification.warning { background: var(--warning-yellow); color: var(--dark-blue); }

        .main-content {
            padding: 40px;
        }

        .tabs {
            display: flex;
            margin-bottom: 40px;
            border-bottom: 3px solid var(--light-gray);
            position: relative;
        }

        .tab {
            padding: 18px 30px;
            background: var(--light-gray);
            border: none;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            margin-right: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-gray);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .tab::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--primary-orange);
            transform: scaleX(0);
            transition: var(--transition);
        }

        .tab:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .tab.active {
            background: var(--primary-orange);
            color: white;
            box-shadow: var(--shadow-light);
        }

        .tab.active::before {
            transform: scaleX(1);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            text-align: center;
            box-shadow: var(--shadow-medium);
            border-left: 5px solid var(--primary-orange);
            position: relative;
            overflow: hidden;
            transition: var(--transition);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 107, 53, 0.05) 0%, transparent 70%);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .stat-card:hover::before {
            transform: scale(1.2);
        }

        .stat-number {
            font-size: 3em;
            font-weight: 700;
            color: var(--primary-orange);
            margin-bottom: 10px;
            position: relative;
            z-index: 2;
        }

        .stat-label {
            color: var(--text-gray);
            font-weight: 600;
            font-size: 1.1em;
            position: relative;
            z-index: 2;
        }

        .form-section {
            background: var(--light-gray);
            padding: 30px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            border-left: 5px solid var(--primary-orange);
            position: relative;
        }

        .form-section h2 {
            color: var(--dark-blue);
            margin-bottom: 25px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
        }

        .form-section h2::before {
            content: "üìã";
            margin-right: 12px;
            font-size: 1.2em;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }

        .form-group {
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-blue);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px 18px;
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
            background: white;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-orange);
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
            transform: translateY(-2px);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .btn {
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--secondary-orange) 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow-light);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: var(--transition);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 107, 53, 0.4);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
        }

        .btn-secondary:hover {
            box-shadow: 0 8px 20px rgba(108, 117, 125, 0.4);
        }

        .btn-small {
            padding: 10px 20px;
            font-size: 14px;
        }

        .btn-danger {
            background: var(--danger-red);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        .btn-danger:hover {
            box-shadow: 0 8px 20px rgba(220, 53, 69, 0.4);
        }

        .search-filter {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
            background: var(--light-gray);
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-light);
        }

        .search-input {
            flex: 1;
            min-width: 250px;
        }

        .filter-select {
            min-width: 180px;
        }

        .customer-grid {
            display: grid;
            gap: 25px;
            margin-top: 25px;
        }

        .customer-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow-medium);
            border-left: 5px solid var(--border-gray);
            position: relative;
            transition: var(--transition);
            overflow: hidden;
        }

        .customer-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.02) 0%, transparent 50%);
            opacity: 0;
            transition: var(--transition);
        }

        .customer-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .customer-card:hover::before {
            opacity: 1;
        }

        .customer-card.due-soon {
            border-left-color: var(--warning-yellow);
            background: linear-gradient(135deg, #fff8e1 0%, #ffffff 100%);
        }

        .customer-card.due-now {
            border-left-color: var(--secondary-orange);
            background: linear-gradient(135deg, #fff4e6 0%, #ffffff 100%);
        }

        .customer-card.overdue {
            border-left-color: var(--danger-red);
            background: linear-gradient(135deg, #ffebee 0%, #ffffff 100%);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: var(--shadow-medium); }
            50% { box-shadow: 0 10px 25px rgba(220, 53, 69, 0.3); }
        }

        .status-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            z-index: 3;
        }

        .status-badge.green {
            background: var(--success-green);
            color: white;
        }

        .status-badge.yellow {
            background: var(--warning-yellow);
            color: var(--dark-blue);
        }

        .status-badge.red {
            background: var(--danger-red);
            color: white;
        }

        .customer-info {
            position: relative;
            z-index: 2;
        }

        .customer-info h3 {
            color: var(--dark-blue);
            margin-bottom: 15px;
            font-size: 1.4em;
            font-weight: 700;
        }

        .customer-info p {
            margin-bottom: 10px;
            color: var(--text-gray);
            line-height: 1.5;
        }

        .customer-info strong {
            color: var(--dark-blue);
            font-weight: 600;
        }

        .service-notification {
            background: linear-gradient(135deg, var(--light-gray) 0%, #ffffff 100%);
            padding: 15px;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-orange);
            margin: 15px 0;
            font-size: 14px;
            position: relative;
            overflow: hidden;
        }

        .service-notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary-orange);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 5px var(--primary-orange); }
            to { box-shadow: 0 0 15px var(--primary-orange); }
        }

        .service-notification strong {
            color: var(--primary-orange);
            display: flex;
            align-items: center;
        }

        .customer-actions {
            margin-top: 25px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            position: relative;
            z-index: 2;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-gray);
        }

        .empty-state .icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
            color: var(--dark-blue);
        }

        .empty-state p {
            font-size: 1.1em;
            line-height: 1.6;
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .login-card {
                padding: 30px;
            }

            .header {
                padding: 30px 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .main-content {
                padding: 20px;
            }

            .tabs {
                flex-direction: column;
                gap: 5px;
            }

            .tab {
                margin-right: 0;
                border-radius: var(--border-radius);
            }

            .form-row {
                grid-template-columns: 1fr;
            }
            
            .search-filter {
                flex-direction: column;
                align-items: stretch;
            }
            
            .customer-actions {
                justify-content: center;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .stat-number {
                font-size: 2.5em;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .customer-card {
                padding: 20px;
            }

            .status-badge {
                position: static;
                display: inline-block;
                margin-bottom: 15px;
            }
        }

        /* Hide main app initially */
        .main-app {
            display: none;
        }

        .main-app.authenticated {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <div class="login-card">
            <div class="login-header">
                <h1>üè¢ SUNBURST Hood Cleaning</h1>
                <p>Customer Management System</p>
            </div>
            <form class="login-form" id="loginForm">
                <div id="errorMessage" class="error-message" style="display: none;"></div>
                <div class="form-group">
                    <label for="adminPin">Admin PIN</label>
                    <input type="tel" id="adminPin" required placeholder="Enter 6-digit PIN" maxlength="6" pattern="[0-9]{6}" title="Please enter a valid 6-digit PIN">
                </div>
                <button type="submit" class="login-btn" id="loginBtn">
                    üîê Access Dashboard
                </button>
            </form>
        </div>
    </div>

    <!-- Main Application -->
    <div class="main-app" id="mainApp">
        <div class="loading-overlay" id="loadingOverlay">
            <div class="spinner"></div>
        </div>

        <div class="notification" id="notification"></div>

        <div class="container">
            <div class="header">
                <button class="logout-btn" onclick="logout()">üö™ Logout</button>
                <h1>üè¢ SUNBURST Hood Cleaning, LLC</h1>
                <p>Professional Customer Management System</p>
            </div>

            <div class="main-content">
                <div class="tabs">
                    <button class="tab active" data-tab="dashboard">üìä Dashboard</button>
                    <button class="tab" data-tab="customers">üë• All Customers</button>
                    <button class="tab" data-tab="add-customer">‚ûï Add Customer</button>
                </div>

                <!-- Dashboard Tab -->
                <div id="dashboard" class="tab-content active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="totalCustomers">0</div>
                            <div class="stat-label">Total Customers</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="dueSoon">0</div>
                            <div class="stat-label">Due in 30 Days</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="dueNow">0</div>
                            <div class="stat-label">Due This Month</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="overdue">0</div>
                            <div class="stat-label">Overdue</div>
                        </div>
                    </div>

                    <h2 style="margin-bottom: 25px; color: var(--dark-blue); font-size: 1.8em;">üö® Urgent Attention Needed</h2>
                    <div id="urgentCustomers" class="customer-grid"></div>
                </div>

                <!-- All Customers Tab -->
                <div id="customers" class="tab-content">
                    <div class="search-filter">
                        <input type="text" class="search-input" id="searchInput" placeholder="üîç Search customers by name, business, or city...">
                        <select class="filter-select" id="statusFilter">
                            <option value="">All Status</option>
                            <option value="green">‚úÖ Current</option>
                            <option value="yellow">‚ö†Ô∏è Due Soon</option>
                            <option value="red">üö® Overdue</option>
                        </select>
                        <select class="filter-select" id="businessTypeFilter">
                            <option value="">All Business Types</option>
                            <option value="mom-pop">Mom & Pop Restaurant</option>
                            <option value="fast-food">Fast Food Chain</option>
                            <option value="casual-dining">Casual Dining</option>
                            <option value="fine-dining">Fine Dining</option>
                            <option value="hotel">Hotel/Resort</option>
                            <option value="school">School</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div id="allCustomers" class="customer-grid"></div>
                </div>

                <!-- Add Customer Tab -->
                <div id="add-customer" class="tab-content">
                    <form id="customerForm">
                        <div class="form-section">
                            <h2>Basic Information</h2>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="businessName">Business Name *</label>
                                    <input type="text" id="businessName" required placeholder="Enter business name">
                                </div>
                                <div class="form-group">
                                    <label for="contactName">Contact Name *</label>
                                    <input type="text" id="contactName" required placeholder="Enter contact person name">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="contactPhone">Phone Number *</label>
                                    <input type="tel" id="contactPhone" required placeholder="(305) 123-4567" pattern="[\(\)\s\-0-9]{10,17}" minlength="10" maxlength="17" title="Please enter a valid phone number">
                                </div>
                                <div class="form-group">
                                    <label for="contactEmail">Email Address</label>
                                    <input type="email" id="contactEmail" placeholder="contact@business.com">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="address">Street Address *</label>
                                <input type="text" id="address" required placeholder="123 Main Street">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="suiteNumber">Suite/Unit Number</label>
                                    <input type="text" id="suiteNumber" placeholder="Suite 100, Unit B, etc.">
                                </div>
                                <div class="form-group">
                                    <label for="city">City *</label>
                                    <input type="text" id="city" required placeholder="Enter city">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="state">State *</label>
                                    <input type="text" id="state" required value="FL" readonly style="background-color: #f8f9fa; color: #666;">
                                </div>
                                <div class="form-group">
                                    <label for="zipCode">ZIP Code *</label>
                                    <input type="tel" id="zipCode" required placeholder="33139" pattern="[0-9]{5}(-[0-9]{4})?" minlength="5" maxlength="10" title="Please enter a valid ZIP code (12345 or 12345-6789)">
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>Business Details</h2>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="businessType">Business Type *</label>
                                    <select id="businessType" required>
                                        <option value="">Select Business Type</option>
                                        <option value="mom-pop">Mom & Pop Restaurant</option>
                                        <option value="fast-food">Fast Food Chain</option>
                                        <option value="casual-dining">Casual Dining</option>
                                        <option value="fine-dining">Fine Dining</option>
                                        <option value="food-truck">Food Truck/Trailer</option>
                                        <option value="hotel">Hotel/Resort</option>
                                        <option value="hospital">Hospital/Medical</option>
                                        <option value="church">Church/Religious</option>
                                        <option value="school">School/Educational</option>
                                        <option value="corporate">Corporate Cafeteria</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="serviceFrequency">Service Frequency *</label>
                                    <select id="serviceFrequency" required>
                                        <option value="">Select Frequency</option>
                                        <option value="monthly">Every Month</option>
                                        <option value="every-2-months">Every 2 Months</option>
                                        <option value="quarterly">Every 3 Months</option>
                                        <option value="every-4-months">Every 4 Months</option>
                                        <option value="semi-annual">Every 6 Months</option>
                                        <option value="annual">Once Per Year</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h2>Service History</h2>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="startDate">Service Start Date *</label>
                                    <input type="date" id="startDate" required>
                                </div>
                                <div class="form-group">
                                    <label for="lastService">Last Service Date</label>
                                    <input type="date" id="lastService">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="notes">Additional Notes</label>
                                <textarea id="notes" placeholder="Special requirements, access details, equipment notes, etc."></textarea>
                            </div>
                        </div>

                        <div style="text-align: center; margin-top: 40px;">
                            <button type="submit" class="btn" id="submitBtn">üíæ Save Customer</button>
                            <button type="button" class="btn btn-secondary" id="clearBtn" style="margin-left: 20px;">üóëÔ∏è Clear Form</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Authentication Configuration
        const ADMIN_PIN = '123098'; // Change this to your desired PIN
        const SESSION_KEY = 'sunburst_admin_session';

        // Application variables
        let customers = [];
        let supabase = null;
        let currentEditingId = null;
        let isDemo = false;

        // Authentication functions
        function checkAuthentication() {
            const session = sessionStorage.getItem(SESSION_KEY);
            if (session === 'authenticated') {
                showMainApp();
                return true;
            }
            showLoginScreen();
            return false;
        }

        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').classList.remove('authenticated');
        }

        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').classList.add('authenticated');
        }

        function login(pin) {
            if (pin === ADMIN_PIN) {
                sessionStorage.setItem(SESSION_KEY, 'authenticated');
                showMainApp();
                showNotification('Welcome to SUNBURST Customer Management! üéâ', 'success');
                initializeApp();
                return true;
            }
            return false;
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                sessionStorage.removeItem(SESSION_KEY);
                showLoginScreen();
                showNotification('Logged out successfully', 'success');
            }
        }

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const pin = document.getElementById('adminPin').value;
            const errorDiv = document.getElementById('errorMessage');
            const loginBtn = document.getElementById('loginBtn');
            
            loginBtn.textContent = 'üîê Authenticating...';
            loginBtn.disabled = true;
            
            setTimeout(() => {
                if (login(pin)) {
                    errorDiv.style.display = 'none';
                } else {
                    errorDiv.textContent = '‚ùå Invalid PIN. Please try again.';
                    errorDiv.style.display = 'block';
                    document.getElementById('adminPin').value = '';
                }
                
                loginBtn.textContent = 'üîê Access Dashboard';
                loginBtn.disabled = false;
            }, 500);
        });

        // Utility functions
        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // Phone number formatting
        function formatPhoneNumber(value) {
            const phoneNumber = value.replace(/\D/g, '');
            
            if (phoneNumber.length >= 6) {
                return `(${phoneNumber.slice(0, 3)}) ${phoneNumber.slice(3, 6)}-${phoneNumber.slice(6, 10)}`;
            } else if (phoneNumber.length >= 3) {
                return `(${phoneNumber.slice(0, 3)}) ${phoneNumber.slice(3)}`;
            } else {
                return phoneNumber;
            }
        }

        function formatZipCode(value) {
            const zipCode = value.replace(/[^\d-]/g, '');
            
            if (zipCode.length > 5 && !zipCode.includes('-')) {
                return `${zipCode.slice(0, 5)}-${zipCode.slice(5, 9)}`;
            }
            return zipCode;
        }

        async function initSupabase() {
            try {
                if (typeof window.supabase === 'undefined') {
                    throw new Error('Supabase library not available');
                }

                const SUPABASE_URL = 'https://addrzxptnszahokeqcof.supabase.co';
                const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFkZHJ6eHB0bnN6YWhva2VxY29mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQyNDM5NDAsImV4cCI6MjA2OTgxOTk0MH0.1XfLwQ_O0iSrcQBPIiL4HPxrJ1ZIY-nglluViOFTIUM';
                
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                
                console.log('Testing database connection...');
                const { error } = await supabase
                    .from('hood_customers')
                    .select('id', { count: 'exact', head: true });
                
                if (error) {
                    throw new Error(`Database connection test failed: ${error.message}`);
                }
                
                console.log('Database connection successful');
                isDemo = false;
                return true;
                
            } catch (error) {
                console.error('Supabase initialization failed:', error);
                return false;
            }
        }

        async function loadCustomers() {
            try {
                if (!supabase) {
                    throw new Error('Database not connected');
                }

                console.log('Loading customers from database...');
                
                const { data, error } = await supabase
                    .from('hood_customers')
                    .select('*')
                    .order('business_name');
                
                if (error) {
                    console.error('Supabase error:', error);
                    throw new Error(`Database query failed: ${error.message}`);
                }
                
                customers = data || [];
                console.log(`Loaded ${customers.length} customers`);
                
                updateDashboard();
                displayAllCustomers();
                
            } catch (error) {
                console.error('Error loading customers:', error);
                throw new Error(`Failed to load customers: ${error.message}`);
            }
        }

        function initDemoMode() {
            console.log('Starting in demo mode...');
            isDemo = true;
            customers = [
                {
                    id: 1,
                    business_name: "Tony's Italian Kitchen",
                    contact_name: "Tony Rossi",
                    contact_phone: "(305) 555-0123",
                    contact_email: "tony@tonysitalian.com",
                    address: "456 Ocean Drive",
                    suite_number: null,
                    city: "Miami Beach",
                    state: "FL",
                    zip_code: "33139",
                    business_type: "casual-dining",
                    service_frequency: "monthly",
                    start_date: "2023-06-01",
                    last_service: "2025-01-15",
                    notes: "Access through back alley, key code 1234"
                },
                {
                    id: 2,
                    business_name: "Burger Palace Express",
                    contact_name: "Sarah Johnson",
                    contact_phone: "(305) 555-0456",
                    contact_email: "sarah@burgerpalace.com",
                    address: "789 Collins Ave",
                    suite_number: "Suite 2B",
                    city: "Miami Beach",
                    state: "FL",
                    zip_code: "33141",
                    business_type: "fast-food",
                    service_frequency: "monthly",
                    start_date: "2024-03-15",
                    last_service: "2024-12-20",
                    notes: "Very busy location, prefer early morning service"
                },
                {
                    id: 3,
                    business_name: "Ocean View Hotel Restaurant",
                    contact_name: "Michael Chen",
                    contact_phone: "(305) 555-0789",
                    contact_email: "mchen@oceanviewhotel.com",
                    address: "1200 Biscayne Blvd",
                    suite_number: "Level 3",
                    city: "Miami",
                    state: "FL",
                    zip_code: "33132",
                    business_type: "hotel",
                    service_frequency: "every-2-months",
                    start_date: "2022-08-01",
                    last_service: "2024-11-05",
                    notes: "Large commercial kitchen, requires 4-hour service window"
                },
                {
                    id: 4,
                    business_name: "Sunset Elementary Cafeteria",
                    contact_name: "Lisa Martinez",
                    contact_phone: "(305) 555-0321",
                    contact_email: "lmartinez@sunsetelem.edu",
                    address: "345 SW 8th Street",
                    suite_number: null,
                    city: "Miami",
                    state: "FL",
                    zip_code: "33135",
                    business_type: "school",
                    service_frequency: "quarterly",
                    start_date: "2023-01-10",
                    last_service: "2024-10-15",
                    notes: "School schedule - service during school breaks only"
                }
            ];
            
            updateDashboard();
            displayAllCustomers();
            
            showNotification('Demo mode active - Database connection unavailable üìä', 'warning');
        }

        function getDaysUntilNextService(lastServiceDate, frequency) {
            if (!lastServiceDate) return null;
            
            const last = new Date(lastServiceDate);
            const today = new Date();
            
            const frequencyDays = {
                'monthly': 30,
                'every-2-months': 60,
                'quarterly': 90,
                'every-4-months': 120,
                'semi-annual': 180,
                'annual': 365
            };
            
            const intervalDays = frequencyDays[frequency] || 90;
            const nextService = new Date(last.getTime() + (intervalDays * 24 * 60 * 60 * 1000));
            const timeDiff = nextService.getTime() - today.getTime();
            const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
            
            return daysDiff;
        }

        function getServiceStatus(customer) {
            const days = getDaysUntilNextService(customer.last_service, customer.service_frequency);
            
            if (days === null) {
                return { 
                    status: 'green', 
                    text: 'No Service Date', 
                    days: null, 
                    notification: 'üìÖ Set last service date to track schedule' 
                };
            }
            
            if (days < 0) {
                const overdueDays = Math.abs(days);
                return { 
                    status: 'red', 
                    text: 'OVERDUE', 
                    days: overdueDays, 
                    notification: `üö® ${overdueDays} day${overdueDays > 1 ? 's' : ''} overdue - Schedule ASAP!` 
                };
            }
            
            if (days <= 30) {
                return { 
                    status: 'yellow', 
                    text: 'DUE SOON', 
                    days: days, 
                    notification: `‚ö†Ô∏è ${days} day${days > 1 ? 's' : ''} until service due - Schedule soon` 
                };
            }
            
            return { 
                status: 'green', 
                text: 'CURRENT', 
                days: days, 
                notification: `‚úÖ ${days} day${days > 1 ? 's' : ''} until next service needed` 
            };
        }

        function getServiceLength(startDate) {
            if (!startDate) return 'Unknown';
            
            const start = new Date(startDate);
            const today = new Date();
            const diffTime = Math.abs(today - start);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays < 30) return `${diffDays} days`;
            if (diffDays < 365) return `${Math.floor(diffDays / 30)} months`;
            
            const years = Math.floor(diffDays / 365);
            const months = Math.floor((diffDays % 365) / 30);
            return `${years} year${years > 1 ? 's' : ''}${months > 0 ? `, ${months} month${months > 1 ? 's' : ''}` : ''}`;
        }

        function formatBusinessType(type) {
            return type.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        function createCustomerCard(customer) {
            const status = getServiceStatus(customer);
            const serviceLength = getServiceLength(customer.start_date);
            
            let nextServiceDate = '';
            if (customer.last_service && status.days !== null) {
                const last = new Date(customer.last_service);
                const frequencyDays = {
                    'monthly': 30,
                    'every-2-months': 60,
                    'quarterly': 90,
                    'every-4-months': 120,
                    'semi-annual': 180,
                    'annual': 365
                };
                const intervalDays = frequencyDays[customer.service_frequency] || 90;
                const nextService = new Date(last.getTime() + (intervalDays * 24 * 60 * 60 * 1000));
                nextServiceDate = nextService.toLocaleDateString();
            }
            
            const cardClass = status.status === 'yellow' ? 'due-soon' : 
                             status.status === 'red' ? 'overdue' : '';
            
            return `
                <div class="customer-card ${cardClass}" data-customer-id="${customer.id}">
                    <div class="status-badge ${status.status}">${status.text}</div>
                    <div class="customer-info">
                        <h3>üè¢ ${customer.business_name}</h3>
                        <p><strong>üë§ Contact:</strong> ${customer.contact_name}</p>
                        <p><strong>üìû Phone:</strong> ${customer.contact_phone}</p>
                        ${customer.contact_email ? `<p><strong>üìß Email:</strong> ${customer.contact_email}</p>` : ''}
                        <p><strong>üìç Address:</strong> ${customer.address}${customer.suite_number ? `, ${customer.suite_number}` : ''}</p>
                        <p><strong>üèôÔ∏è City:</strong> ${customer.city}, ${customer.state} ${customer.zip_code}</p>
                        <p><strong>üè™ Type:</strong> ${formatBusinessType(customer.business_type)}</p>
                        <p><strong>üîÑ Frequency:</strong> ${formatBusinessType(customer.service_frequency)}</p>
                        <p><strong>‚è±Ô∏è Customer Since:</strong> ${serviceLength}</p>
                        ${customer.last_service ? `<p><strong>üßΩ Last Service:</strong> ${new Date(customer.last_service).toLocaleDateString()}</p>` : ''}
                        ${nextServiceDate ? `<p><strong>üìÖ Next Service Due:</strong> ${nextServiceDate}</p>` : ''}
                        <div class="service-notification">
                            <strong>${status.notification}</strong>
                        </div>
                        ${customer.notes ? `<p><strong>üìù Notes:</strong> ${customer.notes}</p>` : ''}
                    </div>
                    <div class="customer-actions">
                        <button class="btn btn-small" onclick="editCustomer(${customer.id})">‚úèÔ∏è Edit</button>
                        <button class="btn btn-small" onclick="markServiced(${customer.id})">‚úÖ Mark Serviced</button>
                        <button class="btn btn-danger btn-small" onclick="confirmDeleteCustomer(${customer.id})">üóëÔ∏è Delete</button>
                    </div>
                </div>
            `;
        }

        function updateDashboard() {
            const stats = {
                total: customers.length,
                dueSoon: 0,
                dueNow: 0,
                overdue: 0
            };
            
            const urgentCustomers = [];
            
            customers.forEach(customer => {
                const status = getServiceStatus(customer);
                if (status.status === 'yellow') {
                    stats.dueSoon++;
                    urgentCustomers.push(customer);
                } else if (status.status === 'red') {
                    stats.overdue++;
                    urgentCustomers.push(customer);
                }
            });
            
            urgentCustomers.sort((a, b) => {
                const statusA = getServiceStatus(a);
                const statusB = getServiceStatus(b);
                
                if (statusA.status === 'red' && statusB.status !== 'red') return -1;
                if (statusB.status === 'red' && statusA.status !== 'red') return 1;
                
                if (statusA.days !== null && statusB.days !== null) {
                    return statusA.days - statusB.days;
                }
                
                return 0;
            });
            
            document.getElementById('totalCustomers').textContent = stats.total;
            document.getElementById('dueSoon').textContent = stats.dueSoon;
            document.getElementById('dueNow').textContent = stats.dueSoon;
            document.getElementById('overdue').textContent = stats.overdue;
            
            const urgentContainer = document.getElementById('urgentCustomers');
            if (urgentCustomers.length === 0) {
                urgentContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üéâ</div>
                        <h3>All Customers Are Current!</h3>
                        <p>Great job! No urgent attention needed at this time.</p>
                    </div>
                `;
            } else {
                urgentContainer.innerHTML = urgentCustomers.map(customer => createCustomerCard(customer)).join('');
            }
        }

        function displayAllCustomers() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const businessTypeFilter = document.getElementById('businessTypeFilter').value;
            
            let filteredCustomers = [...customers];
            
            if (searchTerm) {
                filteredCustomers = filteredCustomers.filter(customer => 
                    customer.business_name.toLowerCase().includes(searchTerm) ||
                    customer.contact_name.toLowerCase().includes(searchTerm) ||
                    customer.city.toLowerCase().includes(searchTerm) ||
                    customer.contact_phone.includes(searchTerm)
                );
            }
            
            if (statusFilter) {
                filteredCustomers = filteredCustomers.filter(customer => {
                    const status = getServiceStatus(customer);
                    return status.status === statusFilter;
                });
            }
            
            if (businessTypeFilter) {
                filteredCustomers = filteredCustomers.filter(customer => 
                    customer.business_type === businessTypeFilter
                );
            }

            filteredCustomers.sort((a, b) => {
                const statusA = getServiceStatus(a);
                const statusB = getServiceStatus(b);
                
                const priorityOrder = { 'red': 3, 'yellow': 2, 'green': 1 };
                const priorityDiff = priorityOrder[statusB.status] - priorityOrder[statusA.status];
                
                if (priorityDiff !== 0) return priorityDiff;
                
                return a.business_name.localeCompare(b.business_name);
            });
            
            const container = document.getElementById('allCustomers');
            if (filteredCustomers.length === 0) {
                const emptyMessage = searchTerm || statusFilter || businessTypeFilter 
                    ? 'No customers found matching your search criteria.'
                    : 'No customers added yet. Add your first customer to get started!';
                
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üîç</div>
                        <h3>No Results Found</h3>
                        <p>${emptyMessage}</p>
                    </div>
                `;
            } else {
                container.innerHTML = filteredCustomers.map(customer => createCustomerCard(customer)).join('');
            }
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            if (tabName === 'dashboard') {
                updateDashboard();
            } else if (tabName === 'customers') {
                displayAllCustomers();
            }
        }

        async function saveCustomer(customerData) {
            try {
                const { data, error } = await supabase
                    .from('hood_customers')
                    .insert([customerData])
                    .select();
                
                if (error) throw error;
                return data[0];
            } catch (error) {
                console.error('Error saving customer:', error);
                throw error;
            }
        }

        async function updateCustomer(customerId, customerData) {
            try {
                const { data, error } = await supabase
                    .from('hood_customers')
                    .update(customerData)
                    .eq('id', customerId)
                    .select();
                
                if (error) throw error;
                return data[0];
            } catch (error) {
                console.error('Error updating customer:', error);
                throw error;
            }
        }

        async function deleteCustomer(customerId) {
            try {
                const { error } = await supabase
                    .from('hood_customers')
                    .delete()
                    .eq('id', customerId);
                
                if (error) throw error;
            } catch (error) {
                console.error('Error deleting customer:', error);
                throw error;
            }
        }

        async function handleFormSubmit(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'üíæ Saving...';
            submitBtn.disabled = true;
            
            try {
                const formData = {
                    business_name: document.getElementById('businessName').value.trim(),
                    contact_name: document.getElementById('contactName').value.trim(),
                    contact_phone: document.getElementById('contactPhone').value.trim(),
                    contact_email: document.getElementById('contactEmail').value.trim() || null,
                    address: document.getElementById('address').value.trim(),
                    suite_number: document.getElementById('suiteNumber').value.trim() || null,
                    city: document.getElementById('city').value.trim(),
                    state: document.getElementById('state').value.trim(),
                    zip_code: document.getElementById('zipCode').value.trim(),
                    business_type: document.getElementById('businessType').value,
                    service_frequency: document.getElementById('serviceFrequency').value,
                    start_date: document.getElementById('startDate').value,
                    last_service: document.getElementById('lastService').value || null,
                    notes: document.getElementById('notes').value.trim() || null
                };
                
                if (isDemo) {
                    if (currentEditingId) {
                        const customerIndex = customers.findIndex(c => c.id === currentEditingId);
                        if (customerIndex !== -1) {
                            customers[customerIndex] = { ...formData, id: currentEditingId };
                        }
                        showNotification('Customer updated successfully! (Demo Mode)', 'success');
                    } else {
                        const newCustomer = { ...formData, id: Date.now() };
                        customers.push(newCustomer);
                        showNotification('Customer added successfully! (Demo Mode)', 'success');
                    }
                    updateDashboard();
                    displayAllCustomers();
                } else {
                    if (currentEditingId) {
                        await updateCustomer(currentEditingId, formData);
                        showNotification('Customer updated successfully!', 'success');
                    } else {
                        await saveCustomer(formData);
                        showNotification('Customer added successfully!', 'success');
                    }
                    await loadCustomers();
                }
                
                currentEditingId = null;
                clearForm();
                showTab('customers');
                
            } catch (error) {
                console.error('Error saving customer:', error);
                showNotification('Error saving customer. Please try again.', 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        function clearForm() {
            document.getElementById('customerForm').reset();
            currentEditingId = null;
            document.getElementById('submitBtn').textContent = 'üíæ Save Customer';
            document.getElementById('state').value = 'FL';
        }

        async function markServiced(customerId) {
            try {
                showLoading();
                const today = new Date().toISOString().split('T')[0];
                
                if (isDemo) {
                    const customer = customers.find(c => c.id === customerId);
                    if (customer) {
                        customer.last_service = today;
                        updateDashboard();
                        displayAllCustomers();
                        showNotification('Customer marked as serviced! (Demo Mode)', 'success');
                    }
                } else {
                    await updateCustomer(customerId, { last_service: today });
                    await loadCustomers();
                    showNotification('Customer marked as serviced!', 'success');
                }
            } catch (error) {
                console.error('Error updating customer:', error);
                showNotification('Error updating customer. Please try again.', 'error');
